hoodie
======

Introduction
------------

This document describes the functionality of the hoodie base object. It
provides a number of helper methods dealing with event handling and
connectivity, as well as a unique id generator and a means to set the
endpoint which Hoodie communicates with.

Initialisation
--------------

The Hoodie Client persists state in the browser, like the current user’s
id, session or the connection status to the backend.

``` {.sourceCode .js}
hoodie.account.get('session').then(function (session) {
  if (session) {
    // user is signed in
  } else {
    // user is signed out
  }
})
```

Hoodie integrates Hoodie’s client core modules:

-   [The account API](hoodie.account.html)
-   [The store API](hoodie.store.html)
-   [The connectionStatus API](hoodie.connection-status.html)
-   [The log API](hoodie.log.html)

Example
-------

``` {.sourceCode .js}
var Hoodie = require('@hoodie/client')
var hoodie = new Hoodie({
  url: 'https://myhoodieapp.com',
  PouchDB: require('pouchdb')
})

hoodie.account.signUp({
  username: 'pat@Example.com',
  password: 'secret'
}).then(function (accountAttributes) {
  hoodie.log.info('Signed up as %s', accountAttributes.username)
}).catch(function (error) {
  hoodie.log.error(error)
})
```

Constructor
-----------

``` {.sourceCode .js}
new Hoodie(options)
```

  -------------------------------------------------------------------------
  Argument Type Description                                              Re
                                                                         qu
                                                                         ir
                                                                         ed
  -------- ---- -------------------------------------------------------- --
  options. Cons PouchDB constructor, see also [PouchDB custom            Ye
  PouchDB  truc builds](https://pouchdb.com/custom.html)                 s
           tor                                                           

  options. Stri Set to hostname where Hoodie server runs, if your app    Ye
  url      ng   runs on a different host                                 s

  options. Stri [account                                                 No
  account  ng   options](https://github.com/hoodiehq/hoodie-account-clie 
                nt#constructor).                                         
                `options.url` is always set to `hoodie.url` +            
                '/account/api'                                           

  options. Stri [store                                                   No
  store    ng   options](https://github.com/hoodiehq/hoodie-account-clie 
                nt#constructor).                                         
                `options.PouchDB` is always set to [Hoodie Client’s      
                constructor](https://github.com/hoodiehq/hoodie-client#c 
                onstructor)’s                                            
                options.PouchDB. `options.dbName` is always set to       
                `hoodie.account.id`. `options.remote` is always set to   
                `hoodie.url` + '/store/api'.                             

  options. Stri [task                                                    No
  task     ng   options](https://github.com/hoodiehq/hoodie-client-task# 
                constructor).                                            
                options.userId is always set to hoodie.account.id.       
                options.remote is always set to hoodie.url + '/task/api' 

  options. Stri [connectionStatus                                        No
  connecti ng   options](https://github.com/hoodiehq/hoodie-connection-s 
  onStatus      tatus#constructor).                                      
                `options.url` is always set to `hoodie.url` +            
                '/connection-status/api'. `options.method` is always set 
                to `HEAD`                                                
  -------------------------------------------------------------------------

hoodie.url
----------

Read-only

``` {.sourceCode .js}
hoodie.url
```

full url to the hoodie server, e.g. `http://example.com/hoodie`

hoodie.account
--------------

`hoodie.account` is an instance of
[hoodie-account-client](https://github.com/hoodiehq/hoodie-account-client).
See [account API](https://github.com/hoodiehq/hoodie-account-client#api)

hoodie.store
------------

`hoodie.store` is an instance of
[hoodie-store](https://github.com/hoodiehq/hoodie-store). See [store
API](https://github.com/hoodiehq/hoodie-store#api)

hoodie.connectionStatus
-----------------------

`hoodie.connectionStatus` is an instance of
[hoodie-connection-status](https://github.com/hoodiehq/hoodie-connection-status).
See [connectionStatus
API](https://github.com/hoodiehq/hoodie-connection-status#api)

hoodie.log
----------

`hoodie.log` is an instance of
[hoodie-log](https://github.com/hoodiehq/hoodie-log). See [log
API](https://github.com/hoodiehq/hoodie-log#api)

hoodie.request
--------------

Sends an http request

``` {.sourceCode .js}
hoodie.request(url)
// or
hoodie.request(options)
```

  ------------------------------------------------------------------------
  Argument Type Description                                             Re
                                                                        qu
                                                                        ir
                                                                        ed
  -------- ---- ------------------------------------------------------- --
  url      Stri Relative path or full URL. A path must start with `/`   Ye
           ng   and sends a `GET` request to the path, prefixed by      s
                `hoodie.url`. In case a full URL is passed, a `GET`     
                request to the url is sent.                             

  options. Stri Relative path or full URL. A path must start with `/`   Ye
  url      ng   and sends a `GET` request to the path, prefixed by      s
                `hoodie.url`. In case a full URL is passed, a `GET`     
                request to the url is sent.                             

  options. Stri Defaults to `GET`. One of `GET`, `HEAD`, `POST`, `PUT`, No
  method   ng   `DELETE`.                                               

  options. Obje For `PUT` and `POST` requests, an optional payload can  No
  data     ct,  be sent. It will be stringified before sending the      
           Arra request.                                                
           y,                                                           
           Stri                                                         
           ng                                                           
           or                                                           
           Numb                                                         
           er                                                           

  options. Obje Map of Headers to be sent with the request.             No
  headers  ct                                                           
  ------------------------------------------------------------------------

Examples

``` {.sourceCode .js}
// sends a GET request to hoodie.url + '/foo/api/bar'
hoodie.request('/foo/api/bar')
// sends a GET request to another host
hoodie.request('https://example.com/foo/bar')
// sends a PATCH request to /foo/api/bar
hoodie.request({
  method: 'PATCH',
  url: '/foo/api/bar',
  headers: {
    'x-my-header': 'my value'
  },
  data: {
    foo: 'bar'
  }
})
```

hoodie.plugin
-------------

Initialise hoodie plugin

``` {.sourceCode .js}
hoodie.plugin(methods)
hoodie.plugin(plugin)
```

  -------------------------------------------------------------------------
  Argument Type Description                                              Re
                                                                         qu
                                                                         ir
                                                                         ed
  -------- ---- -------------------------------------------------------- --
  methods  Obje Method names as keys, functions as values. Methods get   Ye
           ct   directly set on hoodie, e.g. hoodie.plugin({foo:         s
                function () {}}) sets hoodie.foo to function () {}       

  plugins  Func The passed function gets called with hoodie as first     Ye
           tion argument, and can directly set new methods / properties  s
                on it.                                                   
  -------------------------------------------------------------------------

Examples

``` {.sourceCode .js}
hoodie.plugin({
  sayHi: function () { alert('hi') }
})
hoodie.plugin(function (hoodie) {
  hoodie.sayHi = function () { alert('hi') }
})
```

hoodie.reset
------------

TO BE DONE: [\#12](https://github.com/hoodiehq/hoodie-client/issues/12)

Reset hoodie client and emit reset event so plugins can reset as well.

``` {.sourceCode .js}
hoodie.reset()
```

Resolves without argument.

hoodie.on
---------

Subscribe to event.

``` {.sourceCode .js}
hoodie.on(eventName, handler)
```

Example

``` {.sourceCode .js}
hoodie.on('account:signin', function (accountProperties) {
  alert('Hello there, ' + accountProperties.username)
})
```

hoodie.one
----------

Call function once at given event.

``` {.sourceCode .js}
hoodie.one(eventName, handler)
```

Example

``` {.sourceCode .js}
hoodie.one('mycustomevent', function (options) {
  console.log('foo is %s', options.bar)
})
hoodie.trigger('mycustomevent', { foo: 'bar' })
hoodie.trigger('mycustomevent', { foo: 'baz' })
// logs "foo is bar"
// DOES NOT log "foo is baz"
```

hoodie.off
----------

Removes event handler that has been added before

``` {.sourceCode .js}
hoodie.off(eventName, handler)
```

Example

``` {.sourceCode .js}
hoodie.off('connectionstatus:disconnect', showNotification)
```

hoodie.trigger
--------------

Trigger custom events

``` {.sourceCode .js}
hoodie.trigger(eventName[, option1, option2, ...])
```

Example

``` {.sourceCode .js}
hoodie.trigger('mycustomevent', { foo: 'bar' })
```

Events
------

  Event                     Decription
  ------------------------- -------------------------------------------
  `reset`                   triggered when hoodie.reset() succeeded
  `account:*`               events, see account events
  `store:*`                 events, see store events
  `connectionStatus:*`      events, see connectionStatus events

Testing
-------

Local setup

    git clone https://github.com/hoodiehq/hoodie-client.git
    cd hoodie-client
    npm install

Run all tests

    npm test

Run test from one file only

    node tests/specs/id
